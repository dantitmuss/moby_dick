<!DOCTYPE html>
<html>
<head>
    <title>Moby Dick Verse Finder</title>
</head>
<body>
    <h1>Moby Dick Semantic Verse Search</h1>

    <form action="/search" method="post">
        <label for="query">Enter a theme, emotion, or idea:</label><br>
        <input type="text" name="query" id="query" placeholder="e.g., dread, revenge, the sea" required>
        <br><br>
        <button type="submit">Submit</button>
    </form>

    <hr>
    <h2>Or search by tag</h2>

    <form action="/tag_search" method="post">
        <label for="category">Choose a tag category:</label><br>
        <select name="category" id="category" onchange="updateTags()" required>
            <option value="">--Select Category--</option>
            <option value="entities">Entities</option>
            <option value="themes">Themes</option>
            <option value="symbolism">Symbolism</option>
            <option value="feeling">Feeling</option>
            <option value="vibe">Vibe</option>
            <option value="literary_motifs">Literary Motifs</option>
        </select>

        <br><br>

        <label for="tag">Choose a tag:</label><br>
        <select name="tag" id="tag" required>
            <option value="">--Select Tag--</option>
        </select>

        <br><br>
        <button type="submit">Search by Tag</button>
    </form>

    <script>
        let tagsData = {};
    
        // Load the JSON file once on page load
        fetch('/tags.json')
            .then(response => response.json())
            .then(data => {
                tagsData = data;
            })
            .catch(error => {
                console.error("Failed to load tags.json:", error);
            });
    
        function updateTags() {
            const categorySelect = document.getElementById("category");
            const tagSelect = document.getElementById("tag");
            const selectedCategory = categorySelect.value;
    
            // Clear existing options
            tagSelect.innerHTML = '<option value="">--Select Tag--</option>';
    
            // Add new options dynamically from loaded JSON
            if (tagsData[selectedCategory]) {
                tagsData[selectedCategory].forEach(tag => {
                    const option = document.createElement("option");
                    option.value = tag;
                    option.textContent = tag;
                    tagSelect.appendChild(option);
                });
            }
        }
    </script>
</body>
</html>
